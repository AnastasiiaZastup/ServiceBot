<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
  </head>
  <body>
    <h1>–ü—Ä–∏–≤—ñ—Ç üëã</h1>
    <p>–¶–µ —Ç–≤—ñ–π Telegram Mini App!</p>

    <button onclick="testPing()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –±–µ–∫–µ–Ω–¥</button>
    <pre id="result"></pre>

    <button onclick="registerUser()">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
    <pre id="registerResult"></pre>

    <script>
      const tg = window.Telegram.WebApp;
      tg.expand();

      async function testPing() {
        const res = await fetch(
          "https://service-bot-backend.onrender.com/ping"
        );
        const data = await res.json();
        document.getElementById("result").textContent = JSON.stringify(
          data,
          null,
          2
        );
      }

      async function registerUser() {
        const tgUser = tg.initDataUnsafe?.user;

        if (!tgUser?.id) {
          document.getElementById("registerResult").textContent =
            "–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ Telegram ID";
          return;
        }

        const body = {
          telegram_id: tgUser.id,
          name: tgUser.first_name,
          username: tgUser.username || null,
          phone: null,
        };

        try {
          const res = await fetch(
            "https://service-bot-backend.onrender.com/user/register",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(body),
            }
          );

          const data = await res.json();
          document.getElementById("registerResult").textContent =
            JSON.stringify(data, null, 2);
        } catch (err) {
          document.getElementById("registerResult").textContent =
            "–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó";
        }
      }
    </script>
  </body>
</html>
